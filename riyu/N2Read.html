<!DOCTYPE html>
<html>
<head>
    <title>zionlew</title>
    <!-- 设置字符编码 -->
    <meta charset="utf-8" />
    <!-- 手机自适应 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 自定义css样式 -->
    <link href="../assets/css/custom-styles.css" rel="stylesheet" />
        <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            line-height: 1.8;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            font-size: 18px;
        }
        
        p {
            cursor: pointer;
            margin: 20px 0;
        }
        
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 0;
        }
    </style>
</head>

<body>
    <div id="wrapper">

        <!--标题部分-->
        <div id="title-wrapper">
            <h1>2018年12月N2听力</h1>
            <hr />
        </div>

        <!--导航部分-->
        <div id="nav-wrapper">
            <div><span>当前位置：</span><a href="../index.html">首页</a>>日语听力</div>
            <hr />
        </div>

        <!--主体内容-->
        <div id="page-wrapper">
 
            <p>以下は、将棋のプロが書いた文章である。
                物事を(注1)推し進めていくうえで、その土台となるのは創造力でも企画力でもない。いくら創造力や企画力を働かせようとしても、 道具となる知識や材料となる情報がなければ何も始まらないのだ。知識は、頭の中に貯えられた記憶の体験が土台になるのである。つまり、創造力やアイデアの源(注2)は、頭の中の記憶の組み合わせから生まれるもので、その土台がしっかりしていなければ、 良いアイデアが閃くわけがないのだ。
                (注1) 推し進める 進める
                (注2)源:もと
                52. 筆者の考えに合うのはどれか。
                1) 記憶力を高めることによって、 物事がうまく進められる。
                2) 記憶されている知識や情報がもとになって、 良いアイデアが生まれる。
                3) 知識や情報をたくさん集めれば、 創造力や企画力が発揮できる。
                4) どんなことでも記憶しておけば、創造力やアイデアの土台になる。
           </p>

        </div>
    </div>


    <!-- 自定义JS方法 -->
    <script src="../assets/js/custom-scripts.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取所有段落元素
            const paragraphs = document.querySelectorAll('p');
            
            // 定义句子结束标点
            const sentenceEndings = ['.', '!', '?', ';', '。', '！', '？', '；'];
            
            paragraphs.forEach(p => {
                // 为每个段落添加点击事件监听
                p.addEventListener('click', function(e) {
                    // 清除之前的高亮
                    clearHighlights();
                    
                    // 获取点击位置
                    const range = document.caretRangeFromPoint(e.clientX, e.clientY);
                    if (!range) return;
                    
                    // 获取点击的文本节点和偏移量
                    const textNode = range.startContainer;
                    const clickOffset = range.startOffset;
                    
                    // 获取完整的文本内容
                    const fullText = getFullText(p);
                    
                    // 找到点击位置在完整文本中的全局偏移量
                    const globalOffset = getNodeOffset(p, textNode) + clickOffset;
                    
                    // 找出句子边界
                    const sentence = findSentence(fullText, globalOffset, sentenceEndings);
                    
                    if (sentence) {
                        // 创建范围对象
                        const selectionRange = document.createRange();
                        const startNode = findTextNode(p, sentence.start);
                        const endNode = findTextNode(p, sentence.end);
                        
                        if (startNode && endNode) {
                            // 设置选择范围
                            selectionRange.setStart(
                                startNode, 
                                sentence.start - getNodeOffset(p, startNode)
                            );
                            selectionRange.setEnd(
                                endNode, 
                                sentence.end - getNodeOffset(p, endNode)
                            );
                            
                            // 清除现有选择
                            window.getSelection().removeAllRanges();
                            // 添加新选择
                            window.getSelection().addRange(selectionRange);
                            
                            // 添加高亮效果（可选）
                           // highlightSelection(p, sentence.start, sentence.end);

                           
                        }
                    }
                });
            });
            
            // 获取元素及其子元素的所有文本内容
            function getFullText(element) {
                let text = '';
                const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);
                let node = walker.nextNode();
                
                while (node) {
                    text += node.textContent;
                    node = walker.nextNode();
                }
                return text;
            }
            
            // 查找包含指定位置的文本节点
            function findTextNode(element, offset) {
                const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);
                let node = walker.nextNode();
                let currentOffset = 0;
                
                while (node) {
                    const nodeLength = node.textContent.length;
                    if (offset >= currentOffset && offset <= currentOffset + nodeLength) {
                        return node;
                    }
                    currentOffset += nodeLength;
                    node = walker.nextNode();
                }
                return null;
            }
            
            // 获取文本节点在父元素中的偏移量
            function getNodeOffset(parent, node) {
                const walker = document.createTreeWalker(parent, NodeFilter.SHOW_TEXT, null, false);
                let currentNode = walker.nextNode();
                let offset = 0;
                
                while (currentNode && currentNode !== node) {
                    offset += currentNode.textContent.length;
                    currentNode = walker.nextNode();
                }
                return offset;
            }
            
            // 找出包含点击位置的完整句子
            function findSentence(text, clickOffset, endings) {
                let sentenceStart = 0;
                let sentenceEnd = text.length;
                
                // 向前查找句子开始
                for (let i = clickOffset; i >= 0; i--) {
                    if (i === 0 || endings.includes(text[i - 1])) {
                        sentenceStart = i;
                        break;
                    }
                }
                
                // 向后查找句子结束
                for (let i = clickOffset; i < text.length; i++) {
                    if (endings.includes(text[i])) {
                        sentenceEnd = i + 1;
                        break;
                    }
                }
                
                // 返回句子文本和位置
                return {
                    text: text.slice(sentenceStart, sentenceEnd),
                    start: sentenceStart,
                    end: sentenceEnd
                };
            }
            
            // 高亮选中的文本（可选）
            function highlightSelection(element, start, end) {
                // 先清除之前的高亮
                const oldHighlights = element.querySelectorAll('.highlight');
                oldHighlights.forEach(h => {
                    const parent = h.parentNode;
                    parent.replaceChild(document.createTextNode(h.textContent), h);
                    parent.normalize();
                });
                
                // 找到起始和结束的文本节点
                const startNode = findTextNode(element, start);
                const endNode = findTextNode(element, end);
                
                if (!startNode || !endNode) return;
                
                const range = document.createRange();
                range.setStart(startNode, start - getNodeOffset(element, startNode));
                range.setEnd(endNode, end - getNodeOffset(element, endNode));
                
                const span = document.createElement('span');
                span.className = 'highlight';
                range.surroundContents(span);
            }
            
            // 清除所有高亮
            function clearHighlights() {
                document.querySelectorAll('.highlight').forEach(h => {
                    const parent = h.parentNode;
                    parent.replaceChild(document.createTextNode(h.textContent), h);
                    parent.normalize();
                });
            }
        });
        </script>
</body>

</html>
